<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kampagnen-Ergebnisprognose</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Roboto, sans-serif;
  background: #f4f4f6;
  padding: 20px;
}
.calculator {
  max-width: 950px;
  margin: 40px auto;
  background: #fff;
  border-radius: 24px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  padding: 32px;
  color: #1c1c1e;
}
h2 { text-align: center; font-size: 1.8rem; margin-bottom: 6px; }
.subtitle { text-align: center; color: #666; margin-bottom: 24px; }
.input-grid { display: flex; gap: 24px; flex-wrap: wrap; }
.column { flex: 1; min-width: 280px; }
label { font-size: 0.9rem; color: #444; display: block; margin-bottom: 6px; margin-top: 12px; }
input { padding: 10px; border: 1px solid #d2d2d7; border-radius: 10px; font-size: 1rem; background: #f9f9f9; width: 100%; box-sizing: border-box; transition: all 0.2s; }
input:focus { outline: none; border-color: #0071e3; background: white; box-shadow: 0 0 0 2px rgba(0,113,227,0.1); }
.button-main { margin-top: 30px; width: 100%; background: #0071e3; color: white; font-weight: 600; border: none; border-radius: 14px; padding: 14px; font-size: 1.1rem; cursor: pointer; transition: background 0.2s; }
.button-main:hover { background: #0a84ff; }
.results { margin-top: 30px; text-align: center; display: none; }
.result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.result-card { background: #f5f5f7; padding: 16px; border-radius: 16px; }
.result-card.highlight { background: #e8f0fe; box-shadow: 0 0 0 2px #0071e3 inset; }
.result-card h1 { margin: 6px 0; font-size: 1.8rem; }
.warning { color: #d70015; font-weight: 600; margin-top: 10px; }
footer { text-align: center; margin-top: 20px; font-size: 13px; color: #999; }
footer a { color: #0071e3; text-decoration: none; }
footer a:hover { text-decoration: underline; }
.overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 999; }
.overlay-content { background: white; padding: 24px; border-radius: 16px; width: 90%; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
.overlay-content textarea { width: 100%; height: 120px; font-family: monospace; border-radius: 8px; border: 1px solid #ccc; padding: 8px; }
.close-btn { background: #0071e3; color: white; border: none; padding: 8px 16px; border-radius: 8px; margin-top: 12px; cursor: pointer; }
.close-btn:hover { background: #0a84ff; }
</style>
</head>
<body>

<div class="calculator">
  <h2>Kampagnen-Ergebnisprognose</h2>
  <p class="subtitle">Berechne, wie viel Gewinn oder Verlust deine Kampagne bei gegebenem Marketingbudget erzielt.</p>

  <div class="input-grid">
    <div class="column">
      <h3>Grunddaten</h3>
      <label>Bruttoumsatz pro Bestellung (in â‚¬)</label>
      <input id="revenueGross" type="text" placeholder="z. B. 60" oninput="updateNetto()">
      <label>Netto-Umsatz (automatisch)</label>
      <input id="revenueNet" type="text" readonly style="background:#f0f0f0;">
      <label>Variable Kosten (Produktion + Versand, in â‚¬)</label>
      <input id="variableCost" type="text" placeholder="z. B. 30" oninput="updateNetto()">
      <div id="netProfitInfo" style="font-size:0.85rem;color:#0071e3;margin-top:6px;"></div>
    </div>

    <div class="column">
      <h3>Kampagne</h3>
      <label>Marketingbudget (in â‚¬)</label>
      <input id="marketingBudget" type="text" placeholder="z. B. 1.000">
      <label>ROAS</label>
      <input id="roas" type="text" placeholder="z. B. 3">
      <label>Einmalige Fixkosten (optional, in â‚¬)</label>
      <input id="fixedCost" type="text" placeholder="z. B. 0">
    </div>
  </div>

  <button class="button-main" onclick="calcResult()">Berechnen</button>

  <div class="results" id="results">
    <div class="result-grid">
      <div class="result-card highlight">
        <p><strong>Profit pro Werbe-Euro</strong></p>
        <h1 id="profitPerEuro">â€“</h1>
      </div>
      <div class="result-card">
        <p><strong>Gesamtgewinn / -verlust</strong></p>
        <h1 id="totalProfit">â€“</h1>
      </div>
    </div>
    <p id="warning" class="warning"></p>
  </div>

  <footer>
    <a href="#" id="embedLink"><strong>ðŸ”— Rechner einbetten / teilen</strong></a> â€“ entwickelt von <a href="https://www.purple-noon.de" target="_blank">Purple Noon</a>
  </footer>
</div>

<!-- Overlay -->
<div class="overlay" id="overlay">
  <div class="overlay-content">
    <h3>Einbettungscode:</h3>
    <textarea readonly><iframe src="DEIN-RECHNER-URL" width="100%" height="950" style="border:none;"></iframe></textarea>
    <button class="close-btn" onclick="closeOverlay()">SchlieÃŸen</button>
  </div>
</div>

<script>
/* Helfer: lesen/formatieren */
function parseNum(v){
  return parseFloat(String(v).replace(/\./g,"").replace(",",".").replace(/[^\d.-]/g,""))||0;
}
function fmt(num,dec=2){
  return isFinite(num)?num.toLocaleString("de-DE",{minimumFractionDigits:dec,maximumFractionDigits:dec}):"â€“";
}
function formatNumber(num){
  return num.toLocaleString('de-DE', {minimumFractionDigits:2, maximumFractionDigits:2});
}

/* Update Netto-Anzeige + X und Y (nur Anzeige) */
function updateNetto(){
  const gross = parseNum(document.getElementById("revenueGross").value);
  const variable = parseNum(document.getElementById("variableCost").value);
  const net = gross / (gross===0?1:1.19);
  const X = net - variable;
  const Y = gross !== 0 ? X / gross : 0;
  document.getElementById("revenueNet").value = gross ? formatNumber(net) + " â‚¬" : "";
  document.getElementById("netProfitInfo").innerText = gross > 0 ? "Netto-Ertrag pro Bestellung: " + formatNumber(X) + " â‚¬ (Ertrag pro Umsatz: " + fmt(Y,4) + ")" : "";
}

/* Berechnung gemÃ¤ÃŸ deiner Logik:
   X = netto - variable
   Y = X / bruttoumsatz
   umsatz = roas * budget
   ergebnis = umsatz * Y - budget - fixkosten
   Profit pro Werbe-Euro (ohne Fixkosten) = roas * Y - 1
*/
function calcResult(){
  const gross = parseNum(document.getElementById("revenueGross").value);
  const variable = parseNum(document.getElementById("variableCost").value);
  const roas = parseNum(document.getElementById("roas").value);
  const fixed = parseNum(document.getElementById("fixedCost").value);
  const budget = parseNum(document.getElementById("marketingBudget").value);

  const net = gross / (gross===0?1:1.19);
  const X = net - variable; // Netto-Umsatz - Kosten
  const Y = gross !== 0 ? X / gross : 0; // Ertrag pro Umsatz

  const revenue = roas * budget; // Umsatz
  const result = revenue * Y - budget - fixed; // Ergebnis nach deiner Formel

  // Profit pro Werbe-Euro (ohne Fixkosten) = roas * Y - 1
  const profitPerEuro = roas * Y - 1;

  // Anzeige
  document.getElementById("profitPerEuro").innerText = isFinite(profitPerEuro) ? fmt(profitPerEuro,4) : "â€“";
  document.getElementById("totalProfit").innerText = formatNumber(result) + " â‚¬";

  const results = document.getElementById("results");
  results.style.display = "block";
  document.getElementById("warning").innerText = result < 0 ? "Achtung: Verlust bei dieser Kampagne!" : "";
}

/* Formatieren beim Verlassen + input-event fÃ¼r Netto-Aktualisierung */
['revenueGross','variableCost','marketingBudget','roas','fixedCost'].forEach(id=>{
  const el=document.getElementById(id);
  // beim Tippen: nur updateNetto, damit Netto-Anzeige live bleibt
  el.addEventListener('input', updateNetto);
  // beim Verlassen: formatiere mit Tausenderpunkten / entferne ggf. ,00
  el.addEventListener('blur', ()=>{
    const n = parseNum(el.value);
    // bei roas: sinnvoll weniger Nachkommastellen darstellen (2)
    if(id === 'roas'){
      el.value = isFinite(n) ? n.toLocaleString('de-DE',{minimumFractionDigits:0, maximumFractionDigits:2}) : '';
    } else {
      el.value = isFinite(n) ? fmt(n).replace(",00","") : '';
    }
  });
});

/* Overlay */
function closeOverlay(){ document.getElementById("overlay").style.display = "none"; }
document.getElementById("embedLink").addEventListener("click", e => { e.preventDefault(); document.getElementById("overlay").style.display = "flex"; });

/* init */
updateNetto();
</script>

</body>
</html>
